#!/bin/bash

echo "FTP SYNC TASK STARTED at $CURRENT_TIME"

echo "rsync -Lauv --delete-after --chmod=+rx {{ SOURCE_PATH }}/. {{ TARGET_PATH }}/"
rsync -Lauv --delete-after --exclude AUDIT_FILES --exclude "/AUDIT_FILES" --exclude "INTERNAL_FILES" --exclude "/INTERNAL_FILES" --ignore-errors --chmod=+rx "{{ SOURCE_PATH }}/." "{{ TARGET_PATH }}/"
RETURN=$?
echo "Exit code: $RETURN"
CURRENT_TIME=$(date -u +"%Y-%m-%dT%H:%M:%SZ")

if [ $RETURN -eq 0 ];
then
  echo "$CURRENT_TIME: FTP SYNC TASK ENDED successfully"

  exit $RETURN_COMPLETED
else
  echo "$CURRENT_TIME:FTP SYNC TASK ENDED with errors. Exit code: $RETURN"
  exit $RETURN
fi